Options compress=yes;
libname aneesha "/Policy/aneesha.choudhary";
libname cdw '/BIUSASDATA/BIUDATANAS/Rahul Dasgupta/cdw'; 
libname charan "/PolicyNew/"; 
libname Madhuri '/BIUSASDATA/BIUDATANAS/Madhuri Chhabra'; 
libname shpravee '/Policy/PraveenSingh'; 
libname rajendra "/Policy/rajendra.bhoir";
libname ct "/Policy/charanteja.beemanapalli";

data ever_emi_data (keep = merchid merchname merchtype 
outstinstamount overdueamount serno 
caccserno originalamount outstprincipalamount 
creationdate instalmentsnumber interestrate 
status trxndescription instalmentplanserno);
set prime.tctdbs_cinstalments;
Run;

data E1ConsolData1;
set ever_emi_data;
if outstinstamount>0 then live_wtl=1;
else live_wtl=0;
if instalmentplanserno in (642,644,646,648,650,652,654,656,658,660,524,562) 
then wtl = 1; else wtl = 0;
Run;


proc sql;
create table E1Consoldata2 as
select * from E1CONSOLDATA1
where wtl = 1 and status in ("NORM", "PAID");
quit;

proc sql;
select count(distinct caccserno) from E1CONSOLDATA2
where creationdate not like '2025-05%';
quit;


/* Total accounts availed wTL as of month */

data wtl ;
set E1CONSOLDATA2;
format ccreate_date yymmn10.;
informat ccreate_date yymmdd10.;
ccreate_date = input(creationdate,yymmdd10.);
run;

data wtl1a;
set wtl;
new=input(put(ccreate_date, yymmn6.), 6.);
   
run;


proc freq data = wtl1a;
tables new;


/*may  */
data maypro;
set wtl1a;
where new= 202405;

proc sql;
create table novpro1 as 
select distinct a.*, b.overduecycles,   b.balance, b.instalmentbalance, 
b.mo_good_bal from maypro as a 
left join  cc.PORTFOLIO_DATA_202411 as b 
on input(a.caccserno,10.) = b.caccserno; 

data junpro;
set wtl1a;
where new= 202406;

proc sql;
create table decpro1 as 
select distinct a.*, b.overduecycles,   b.balance, b.instalmentbalance, 
b.mo_good_bal from junpro as a 
left join  cc.PORTFOLIO_DATA_202412 as b 
on input(a.caccserno,10.) = b.caccserno; 

data julpro;
set wtl1a;
where new= 202407;

proc sql;
create table janpro1 as 
select distinct a.*, b.overduecycles,   b.balance, b.instalmentbalance, 
b.mo_good_bal from julpro as a 
left join  cc.PORTFOLIO_DATA_202501 as b 
on input(a.caccserno,10.) = b.caccserno; 


data augpro;
set wtl1a;
where new= 202408;

proc sql;
create table febpro1 as 
select distinct a.*, b.overduecycles,   b.balance, b.instalmentbalance, 
b.mo_good_bal from augpro as a 
left join  cc.PORTFOLIO_DATA_202502 as b 
on input(a.caccserno,10.) = b.caccserno; 

data seppro;
set wtl1a;
where new= 202409;

proc sql;
create table marpro1 as 
select distinct a.*, b.overduecycles,   b.balance, b.instalmentbalance, 
b.mo_good_bal from seppro as a 
left join  cc.PORTFOLIO_DATA_202503 as b 
on input(a.caccserno,10.) = b.caccserno; 

data octpro;
set wtl1a;
where new= 202410;

proc sql;
create table aprpro1 as 
select distinct a.*, b.overduecycles,   b.balance, b.instalmentbalance, 
b.mo_good_bal from octpro as a 
left join  cc.PORTFOLIO_DATA_202504 as b 
on input(a.caccserno,10.) = b.caccserno; 

data se6m60wtl;
set novpro1 decpro1 janpro1 febpro1 marpro1 aprpro1 ;

proc freq data = se6m60wtl;
tables new;
